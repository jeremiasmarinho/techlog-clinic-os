<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de M√≥dulos Frontend</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-card.total {
            background: #3498db;
            color: white;
        }
        .stat-card.passed {
            background: #2ecc71;
            color: white;
        }
        .stat-card.failed {
            background: #e74c3c;
            color: white;
        }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste de M√≥dulos Frontend</h1>
        
        <div class="stats">
            <div class="stat-card total">
                <div class="stat-number" id="totalTests">0</div>
                <div class="stat-label">Total de Testes</div>
            </div>
            <div class="stat-card passed">
                <div class="stat-number" id="passedTests">0</div>
                <div class="stat-label">Testes Passados</div>
            </div>
            <div class="stat-card failed">
                <div class="stat-number" id="failedTests">0</div>
                <div class="stat-label">Testes Falhados</div>
            </div>
        </div>

        <button onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
        <button onclick="clearResults()">üóëÔ∏è Limpar Resultados</button>
        
        <div id="results"></div>
    </div>

    <script type="module">
        // Import all modules
        import * as dateUtils from './public/js/utils/date-utils.js';
        import * as currencyUtils from './public/js/utils/currency-utils.js';
        import * as stringUtils from './public/js/utils/string-utils.js';
        import * as apiService from './public/js/services/api-service.js';
        import * as cacheService from './public/js/services/cache-service.js';
        import * as notificationService from './public/js/services/notification-service.js';
        import * as metricsCalculator from './public/js/components/metrics-calculator.js';
        import * as metricsRenderer from './public/js/components/metrics-renderer.js';
        import * as confirmationModal from './public/js/components/confirmation-modal.js';

        // Store modules globally for testing
        window.modules = {
            dateUtils,
            currencyUtils,
            stringUtils,
            apiService,
            cacheService,
            notificationService,
            metricsCalculator,
            metricsRenderer,
            confirmationModal
        };

        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;

        function updateStats() {
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('passedTests').textContent = passedTests;
            document.getElementById('failedTests').textContent = failedTests;
        }

        function logResult(message, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.textContent = `${isSuccess ? '‚úÖ' : '‚ùå'} ${message}`;
            resultsDiv.appendChild(resultDiv);
            
            totalTests++;
            if (isSuccess) {
                passedTests++;
            } else {
                failedTests++;
            }
            updateStats();
        }

        function testSection(title) {
            const resultsDiv = document.getElementById('results');
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'test-section';
            sectionDiv.innerHTML = `<h3>${title}</h3>`;
            resultsDiv.appendChild(sectionDiv);
        }

        window.runAllTests = function() {
            clearResults();

            // Test 1: Module Loading
            testSection('üì¶ Carregamento de M√≥dulos');
            const requiredModules = [
                'dateUtils', 'currencyUtils', 'stringUtils',
                'apiService', 'cacheService', 'notificationService',
                'metricsCalculator', 'metricsRenderer', 'confirmationModal'
            ];

            requiredModules.forEach(moduleName => {
                if (window.modules[moduleName]) {
                    logResult(`M√≥dulo ${moduleName} carregado com sucesso`);
                } else {
                    logResult(`M√≥dulo ${moduleName} N√ÉO foi carregado`, false);
                }
            });

            // Test 2: Date Utils
            testSection('üìÖ Date Utils Functions');
            try {
                const { formatarData, formatarDataHora, calcularIdade } = window.modules.dateUtils;
                
                // Test formatarData
                const testDate = '2024-01-15';
                const formatted = formatarData(testDate);
                if (formatted === '15/01/2024') {
                    logResult(`formatarData('${testDate}') = '${formatted}'`);
                } else {
                    logResult(`formatarData falhou: esperado '15/01/2024', recebido '${formatted}'`, false);
                }

                // Test formatarDataHora
                const testDateTime = '2024-01-15T14:30:00';
                const formattedDateTime = formatarDataHora(testDateTime);
                if (formattedDateTime.includes('15/01/2024') && formattedDateTime.includes('14:30')) {
                    logResult(`formatarDataHora funciona corretamente: '${formattedDateTime}'`);
                } else {
                    logResult(`formatarDataHora falhou: '${formattedDateTime}'`, false);
                }

                // Test calcularIdade
                const birthDate = '1990-01-15';
                const age = calcularIdade(birthDate);
                if (age >= 30 && age <= 40) {
                    logResult(`calcularIdade('${birthDate}') = ${age} anos`);
                } else {
                    logResult(`calcularIdade retornou valor inesperado: ${age}`, false);
                }
            } catch (error) {
                logResult(`Erro nos testes de Date Utils: ${error.message}`, false);
            }

            // Test 3: Currency Utils
            testSection('üí∞ Currency Utils Functions');
            try {
                const { formatarMoeda, formatarMoedaBRL, parseMoeda } = window.modules.currencyUtils;
                
                // Test formatarMoeda
                const formatted = formatarMoeda(1234.56);
                if (formatted.includes('1.234,56') || formatted.includes('1234,56')) {
                    logResult(`formatarMoeda(1234.56) = '${formatted}'`);
                } else {
                    logResult(`formatarMoeda falhou: '${formatted}'`, false);
                }

                // Test formatarMoedaBRL
                const formattedBRL = formatarMoedaBRL(1234.56);
                if (formattedBRL.includes('R$') && formattedBRL.includes('1.234,56')) {
                    logResult(`formatarMoedaBRL(1234.56) = '${formattedBRL}'`);
                } else {
                    logResult(`formatarMoedaBRL falhou: '${formattedBRL}'`, false);
                }

                // Test parseMoeda
                const parsed = parseMoeda('R$ 1.234,56');
                if (parsed === 1234.56) {
                    logResult(`parseMoeda('R$ 1.234,56') = ${parsed}`);
                } else {
                    logResult(`parseMoeda falhou: esperado 1234.56, recebido ${parsed}`, false);
                }
            } catch (error) {
                logResult(`Erro nos testes de Currency Utils: ${error.message}`, false);
            }

            // Test 4: String Utils
            testSection('üî§ String Utils Functions');
            try {
                const { capitalizarPrimeiraLetra, truncarTexto, removerAcentos } = window.modules.stringUtils;
                
                // Test capitalizarPrimeiraLetra
                const capitalized = capitalizarPrimeiraLetra('hello world');
                if (capitalized === 'Hello world') {
                    logResult(`capitalizarPrimeiraLetra('hello world') = '${capitalized}'`);
                } else {
                    logResult(`capitalizarPrimeiraLetra falhou: '${capitalized}'`, false);
                }

                // Test truncarTexto
                const truncated = truncarTexto('Lorem ipsum dolor sit amet', 10);
                if (truncated.length <= 13) { // 10 + '...'
                    logResult(`truncarTexto funciona: '${truncated}'`);
                } else {
                    logResult(`truncarTexto falhou: '${truncated}'`, false);
                }

                // Test removerAcentos
                const noAccents = removerAcentos('Jos√© Andr√©');
                if (noAccents === 'Jose Andre') {
                    logResult(`removerAcentos('Jos√© Andr√©') = '${noAccents}'`);
                } else {
                    logResult(`removerAcentos falhou: '${noAccents}'`, false);
                }
            } catch (error) {
                logResult(`Erro nos testes de String Utils: ${error.message}`, false);
            }

            // Test 5: API Service
            testSection('üåê API Service Functions');
            try {
                const { get, post, put, del } = window.modules.apiService;
                
                if (typeof get === 'function') {
                    logResult('Fun√ß√£o API get() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o API get() N√ÉO est√° dispon√≠vel', false);
                }

                if (typeof post === 'function') {
                    logResult('Fun√ß√£o API post() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o API post() N√ÉO est√° dispon√≠vel', false);
                }

                if (typeof put === 'function') {
                    logResult('Fun√ß√£o API put() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o API put() N√ÉO est√° dispon√≠vel', false);
                }

                if (typeof del === 'function') {
                    logResult('Fun√ß√£o API del() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o API del() N√ÉO est√° dispon√≠vel', false);
                }
            } catch (error) {
                logResult(`Erro nos testes de API Service: ${error.message}`, false);
            }

            // Test 6: Cache Service
            testSection('üíæ Cache Service Functions');
            try {
                const { set, get, remove, clear } = window.modules.cacheService;
                
                // Test set/get
                set('testKey', { name: 'Test', value: 123 });
                const cached = get('testKey');
                if (cached && cached.name === 'Test' && cached.value === 123) {
                    logResult('Cache set/get funciona corretamente');
                } else {
                    logResult('Cache set/get falhou', false);
                }

                // Test remove
                remove('testKey');
                const afterRemove = get('testKey');
                if (afterRemove === null) {
                    logResult('Cache remove funciona corretamente');
                } else {
                    logResult('Cache remove falhou', false);
                }
            } catch (error) {
                logResult(`Erro nos testes de Cache Service: ${error.message}`, false);
            }

            // Test 7: Notification Service
            testSection('üîî Notification Service Functions');
            try {
                const { showSuccess, showError, showInfo, showWarning } = window.modules.notificationService;
                
                if (typeof showSuccess === 'function') {
                    logResult('Fun√ß√£o showSuccess() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o showSuccess() N√ÉO est√° dispon√≠vel', false);
                }

                if (typeof showError === 'function') {
                    logResult('Fun√ß√£o showError() est√° dispon√≠vel');
                } else {
                    logResult('Fun√ß√£o showError() N√ÉO est√° dispon√≠vel', false);
                }
            } catch (error) {
                logResult(`Erro nos testes de Notification Service: ${error.message}`, false);
            }

            // Test 8: Metrics Calculator
            testSection('üìä Metrics Calculator Functions');
            try {
                const { calcularTaxaConversao, calcularTicketMedio } = window.modules.metricsCalculator;
                
                // Test calcularTaxaConversao
                const taxa = calcularTaxaConversao(25, 100);
                if (taxa === 25) {
                    logResult(`calcularTaxaConversao(25, 100) = ${taxa}%`);
                } else {
                    logResult(`calcularTaxaConversao falhou: esperado 25, recebido ${taxa}`, false);
                }

                // Test calcularTicketMedio
                const ticket = calcularTicketMedio(10000, 20);
                if (ticket === 500) {
                    logResult(`calcularTicketMedio(10000, 20) = R$ ${ticket}`);
                } else {
                    logResult(`calcularTicketMedio falhou: esperado 500, recebido ${ticket}`, false);
                }
            } catch (error) {
                logResult(`Erro nos testes de Metrics Calculator: ${error.message}`, false);
            }

            // Final Summary
            setTimeout(() => {
                const successRate = ((passedTests / totalTests) * 100).toFixed(1);
                testSection('üìà Resumo Final');
                logResult(`Taxa de Sucesso: ${successRate}% (${passedTests}/${totalTests} testes)`, successRate >= 90);
            }, 100);
        };

        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            updateStats();
        };

        // Auto-run tests on load
        setTimeout(() => {
            runAllTests();
        }, 500);
    </script>
</body>
</html>
